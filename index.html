<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SQLite ZIP Loader</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background: #f4f4f4;
        padding: 20px;
        text-align: center;
    }
    h1 {
        color: #333;
    }
    button {
        background: #28a745;
        color: white;
        border: none;
        padding: 12px 20px;
        font-size: 16px;
        border-radius: 5px;
        cursor: pointer;
    }
    button:disabled {
        background: #888;
        cursor: not-allowed;
    }
    #status {
        margin-top: 15px;
        font-size: 14px;
        color: #555;
    }
</style>
</head>
<body>

<h1>SQLite DB Loader</h1>
<button id="startBtn">Start Process</button>
<div id="status">Waiting...</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/sql-wasm.js"></script>
<script>
const startBtn = document.getElementById('startBtn');
const statusDiv = document.getElementById('status');

startBtn.addEventListener('click', async () => {
    startBtn.disabled = true;
    statusDiv.textContent = "Downloading ZIP...";

    try {
        // Relative path fetch (same folder)
        const response = await fetch('DM.db.43.0.zip');
        if (!response.ok) throw new Error('HTTP error ' + response.status);

        const arrayBuffer = await response.arrayBuffer();
        statusDiv.textContent = "Unzipping...";

        const zip = await JSZip.loadAsync(arrayBuffer);
        const fileName = Object.keys(zip.files)[0];
        const dbData = await zip.files[fileName].async('uint8array');

        statusDiv.textContent = "Loading database...";
        const SQL = await initSqlJs({ locateFile: file => `https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/${file}` });
        const db = new SQL.Database(dbData);

        // Example Query
        statusDiv.textContent = "Running query...";
        const res = db.exec("SELECT name FROM sqlite_master WHERE type='table';");

        if (res.length > 0) {
            statusDiv.textContent = "Tables: " + res[0].values.map(v => v[0]).join(', ');
        } else {
            statusDiv.textContent = "No tables found.";
        }
    } catch (err) {
        console.error(err);
        statusDiv.textContent = "Error: " + err.message;
    } finally {
        startBtn.disabled = false;
    }
});
</script>

</body>
</html>